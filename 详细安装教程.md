前言
大家好，我是维奇，Intel NUC 交流群（762329385）的一名管理，可能有的人还不太熟悉 Intel NUC，它是 Intel 推出的一系列微型电脑主机，在过去的一年多时间里，它更是因为成熟的黑苹果方案，被众多发烧友推上神坛。NUC8豆子峡谷是一款深得我心的产品，因此本人投入了不少时间和精力致力于 NUC 圈子的良性发展，持续整理了各种资料、维护豆子峡谷的 OpenCore 引导，编写“《NUC8（豆子峡谷）黑苹果新手指南》”。一年多一来，由于选择使用 NUC 黑果的用户日益增多，加Q群咨询的玩家几度爆满。

从群内的聊天话题不难发现，对于刚入手 NUC 微型电脑的新人，装机是头等难题。即便已经有不少群友制作了 NUC 黑苹果的安装教程，但安装 macOS 始终是老生常谈的话题。所以，最近半个月我一直在思考和探索最简单的黑果安装方法，经过了近两周的反复装机测试、简化操作方便小白用户，我制作了《NUC8在线安装U盘制作工具》。兼容在 Win/Mac/Linux 等系统下一键制作在线安装 U 盘。

如果你觉得有用，请给予一定的支持，工具可到文末下载。在此之前，建议先完整阅读本篇教程。

用过白果的人，一定对 Mac 在线安装系统并不陌生，其实咱们的 NUC8 黑苹果也可以，这都得益于小而强大的 OpenCore 引导以及大神们为探索 macOS 服务器镜像所做的努力。当我在尝试完全使用在线安装黑了一台 NUC8 后，自己都感到震惊了，整个过程实在是太安逸了，安装过程简单到堪比安装 Windows。所以强烈推荐全新安装或重装 NUC8 的用户使用。

* 本教程已整合豆子峡谷与冥王峡谷的在线安装教程。

本教程大纲：
1、在线安装的优势
2、BIOS 设置
3、制作在线安装 U 盘
4、安装过程图文记录
5、最简单的摇号操作

首先聊聊，除了安装简单之外，在线安装还有哪些好处？
我总结主要有三大优点：
1、无需下载庞大的 macOS 镜像，也不用忍受x度盘的限速。
  - 制作在线安装 U盘的过程，会从苹果官方下载 500MB 左右的 Recovery 镜像（Big Sur 的为 600+ MB）；之后在安装 macOS 过程中，也是直连苹果服务器。（我这里200M宽带，整个安装过程约半小时）
2、不影响 U 盘继续作为 U 盘使用，且空间占用少。
  - 做好的在线安装 U 盘，只占用约 500MB 空间，剩余空间可以继续存储其他资料。
  - 如果 U 盘空间紧张，还可以删除 U 盘根目录的 com.apple.recovery.boot 文件夹，进一步释放空间；下次装机再使用 NUC8_MacOnlineInstaller 工具下载回来即可，所以 U 盘最小只需存放 OC EFI + NUC8_MacOnlineInstaller，总体积加起来不到 10MB。
3、总能安装到最新的 macOS，工具已经支持大版本选择（Mojave、Catalina、Big Sur）。
  - 因为是联网安装，总能安装到最新的版本（如果选择 Mojave，则安装 10.14.6、Catalina 则是 10.15.7）。如果你下载了完整的 dmg 镜像进行离线安装，反而怎么装都是原先下载到的版本。

BIOS 设置：
黑苹果的关键工作就在开机后和进入系统之前——也就是 BIOS 引导环节，因此提前设置好 BIOS 尤为重要。
豆子峡谷（NUC8ixBEx）的具体设置项如下：（启用为勾选，禁用为不勾选）
1、开机时，连续点按 F2 进入 BIOS，为了避免之前有其他不合适的改动，建议先按 F9 重置 BIOS 默认设置。
2、Boot->Boot Priority->Legacy Boot Priority-> « Legacy Boot » ：禁用
3、Boot->Boot Configuration->
    UEFI Boot->« Fast Boot »： 禁用
    UEFI Boot->« Boot USB Devices First » ： 启用
    UEFI Boot->« Boot Network Devices Last » ：启用
    Boot Devices->«Network Boot» ：设置为 « Disable »
4、Boot->Secure Boot-> « Secure Boot » ：禁用
5、Security->Security Features-> « Inter VT for directed I/VO (VT-d) » ： 禁用
6、Power->Secondary Power Settings-> « Wake on LAN from S4/S5 » ： 设置为 « Stay Off »
以下为使用白果拆机卡的用户设置：
7、Devices->Onboard Devices->  « WLAN » 和  « Bluetooth » ：禁用

哈迪斯·冥王峡谷（NUC8i7HxK）的具体设置项如下：（启用为勾选，禁用为不勾选）
1、开机时，连续点按 F2 进入 BIOS，为了避免之前有其他不合适的改动，建议先按 F9 重置 BIOS 默认设置。
2、Devices->USB-> « Portable Device Charging Mode » ：设置为 « off »
3、Security->Security Features-> « Thunderbolt Security Level » ：设置为 « Legacy Mode »
4、Boot->Secure Boot-> « Secure Boot » ：禁用

按 F10 保存并退出 BIOS。

制作在线安装 U 盘：
- 文中提到的所有工具下载以及制作在线安装 U 盘详细步骤：NUC8 OC 引导 + NUC8_MacOnlineInstaller在线安装工具 + Hackintool

安装过程图文记录：
️关于如何用“开机快捷键激活 Recovery 模式”的操作，不少群友反馈不熟悉操作，这里列出具体方法：

U 盘插入 NUC 后，按下电源键并立即持续点按 F10，进入 BIOS 启动菜单，选择 UEFI 开头的 U 盘，按回车并立即 Cmd+R
（注意按回车和 Cmd+R 不能有明显停顿，Cmd+R 具体按法：Cmd为保持长按，R是连续点按，注意“长按”和“持续点按”的区别）
如果还是不行，可以持续点按 ESC 或 Option/Alt 键，出现 OC 引导菜单后，按空格，出现隐藏引导项“macOS Boot From Recovery”，选中它并回车进入。

Cmd+R 激活 Recovery 模式后，出现苹果 Logo 进度条页面，此过程会完整读取 Recovery 镜像因此会比较慢，耐心等待，进入 Recovery 界面如下：

macOS 恢复模式
选择“磁盘工具”，先格式化要安装 macOS 的硬盘：

选择“磁盘工具”
在这一步，先点击窗口左上角的“显示”-“显示所有设备”，选中根节点的硬盘名称进行“抹掉”操作，无比确保如下图有“名称”、“格式”、“方案”三个选项，而不是两个（如果希望安装双系统，建议先安装 macOS，此步骤会将整个硬盘格式化为 GPT 分区并自动创建一个 200MB 的 EFI 分区）。

格式化系统盘
硬盘格式化后，返回 Recovery 首页。此时需要确保已经正常连接到互联网，联网分有线与无线两种方式：
1、如果有线，直接网线接入 NUC8 网口即可。
2、如要连接 Wi-Fi，要求必须是白果的拆机网卡，要知道在此阶段系统都尚未安装，只有拆机卡才能被免驱识别（读卡器硬改或 M.2 转接都可，如果不明白什么意思，请参考我的另外一篇文章《NUC8（豆子峡谷）黑苹果新手指南Q&A》章节 3.2），连接 Wi-Fi 操作在屏幕右上角，如下图

连接 Wi-Fi
搞定网络连接之后，选择“重新安装 macOS”，并点击继续

选择“重新安装 macOS”
这一步有小概率会遇到弹出错误提示，没有的话跳过这段继续往后，以下是一些常见的问题案例：
（1）“无法安装到磁盘”
问题出在硬盘格式，说明上一步的格式化硬盘时操作有问题，可以去“磁盘工具”重新格式化。
（2）“将安装信息下载到目录宗卷失败”
网络问题。可以重试几次，或者断开重连、或需要切换至其他网络（例如使用手机网络）重试。
（3）“macOS 未能与恢复服务器取得联系”
时间同步问题。菜单中打开「MacOS 实用工具 -- 终端」，输入 date 回车后出现系统时间，一般都是错误的，按照「date 月日时分年」的格式输入命令重置时间（例如 2020 年 5 月 1 日 20 点 40 分，输入「date 0501204020」）。

同意协议
下图左边为我的硬盘，右边为我的 U 盘。选择在前述步骤中格式化好的硬盘，并点击安装

选择硬盘
开始安装了，第一个阶段大概7～10分钟

第一阶段安装
第一个阶段完成后将自动重启，随后出现第二阶段安装，仅有苹果 logo 和进度条，具体时间取决于网速（我这里大约 12 分钟）。

第二阶段安装
第二阶段结束后，出现下图语言设置页面。（在执行安装后的第一、第二阶段，共约20余分钟的安装过程中，无需任何操作干预）

语言设置
接着一步步的系统设置向导这里不再啰嗦，但要注意，过程中如需要登录 Apple ID 或连接苹果服务的步骤凡是能跳过的尽量先跳过（因此时三码尚未替换，教程后面有有摇号的步骤，所以最好教程全部走完之后再使用苹果服务）。
可以在以下步骤中恢复 Mac 备份（支持将白果的时间机器备份恢复过来）：

迁移助理
至此系统安装完成。

最后的曙光
进系统了
查看一下“关于本机”，一切正常。


系统虽装好了，但还要做两件重要的事情：
（1）拷贝 EFI 到硬盘，以便能脱离 U 盘引导 macOS
（2）摇号，即生成随机三码。
这里大推神器 Hackintool，一个工具即可搞定这两件事情。

拷贝 EFI 到硬盘：
打开 Hackintool，选择“磁盘”页，如图挂载硬盘的 EFI 分区。

挂载硬盘 EFI 分区
拷贝 EFI 到硬盘
️注意：
（1）在上图操作时，如果硬盘的 EFI 分区下已经存在 EFI 文件夹，请将其删除或重命名为其他任意名字，切勿与 U 盘拷贝过来的 EFI 文件夹合并。
（2）关于我维护的 NUC8 专用 OC EFI 的用法，请仔细阅读解压得到的说明文件 readme.txt！！！

摇号，即生成随机三码：
（1）用任意文本编辑器打开硬盘 EFI 分区下的 /EFI/OC/config.plist，找到 PlatformInfo 配置部分。
（2）打开 Hackintool，选择“系统”页，“序列号生成器”，点击右下角刷新按钮，执行摇号。
（3）“序列号生成器”中的前三项即为三码，按着图示的对应关系，拷贝到文本编辑器中的 config.plist。三码复制完成后保存并关闭 /EFI/OC/config.plist 文件。

摇号，产生随机三码
为了完美的休眠，我们需要修改电源配置，按下图切换到“电源”页面，点击“修复深度休眠预留空间”，输入登录密码并确认后，保证图中 hibernatemode、proximitywake 均为绿色即可：

修复休眠
至此安装过程全部结束，弹出 U 盘，重启系统即可正常开始使用。

Have Fun !

作者：weachy
链接：https://www.jianshu.com/p/78510cfa4a64
来源：简书
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。
